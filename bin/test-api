#!/usr/bin/env sh
set -e

PROJ=$(cat secrets/project)

if [ -z "${PROJ}" ]; then
    echo "Project not found. Check secrets/project file." >&2
    exit 1
fi

mkdir -p "api/secrets/test"
cp secrets/test/* "api/secrets/test/"

cd ./api

echo "Building test container..." >&2
docker build -f "images/test" -t "${PROJ}/test/api" .

echo "Running tests..." >&2
docker run "${PROJ}/test/api"

echo "Done." >&2
